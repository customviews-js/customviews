/*!
 * @customviews-js/customviews v1.0.2
 * (c) 2025 Chan Ger Teck
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).CustomViews={})}(this,function(t){"use strict";function e(t,e,n){const o=n.get(e);if(!o)return;const s=o.type||function(t){return t.src?"image":t.content&&/<[^>]+>/.test(t.content)?"html":"text"}(o);switch(s){case"image":!function(t,e){if(!e.src)return;t.innerHTML="";const n=document.createElement("img");n.src=e.src,n.alt=e.alt||"",e.className&&(n.className=e.className),e.style&&n.setAttribute("style",e.style),n.style.maxWidth=n.style.maxWidth||"100%",n.style.height=n.style.height||"auto",n.style.display=n.style.display||"block",t.appendChild(n)}(t,o);break;case"text":!function(t,e){null!=e.content&&(t.textContent=e.content),e.className&&(t.className=e.className),e.style&&t.setAttribute("style",e.style)}(t,o);break;case"html":!function(t,e){null!=e.content&&(t.innerHTML=e.content),e.className&&(t.className=e.className),e.style&&t.setAttribute("style",e.style)}(t,o);break;default:t.innerHTML=o.content||String(o),console.warn("[CustomViews] Unknown asset type:",s)}}class n{static STORAGE_KEYS={STATE:"customviews-state"};isStorageAvailable(){return"undefined"!=typeof window&&void 0!==window.localStorage}persistState(t){if(this.isStorageAvailable())try{localStorage.setItem(n.STORAGE_KEYS.STATE,JSON.stringify(t))}catch(t){console.warn("Failed to persist state:",t)}}getPersistedState(){if(!this.isStorageAvailable())return null;try{const t=localStorage.getItem(n.STORAGE_KEYS.STATE);return t?JSON.parse(t):null}catch(t){return console.warn("Failed to parse persisted state:",t),null}}clearAll(){this.isStorageAvailable()&&localStorage.removeItem(n.STORAGE_KEYS.STATE)}hasPersistedData(){return!!this.isStorageAvailable()&&!!this.getPersistedState()}}class o{static parseURL(){const t=new URLSearchParams(window.location.search).get("view");let e=null;if(t)try{e=this.decodeState(t)}catch(t){console.warn("Failed to decode view state from URL:",t)}return e}static updateURL(t){if("undefined"==typeof window||!window.history)return;const e=new URL(window.location.href);if(e.searchParams.delete("view"),t){const n=this.encodeState(t);n&&e.searchParams.set("view",n)}const n=e.pathname+(e.search||"")+(e.hash||"");window.history.replaceState({},"",n)}static clearURL(){this.updateURL(null)}static generateShareableURL(t){const e=new URL(window.location.href);if(e.searchParams.delete("view"),t){const n=this.encodeState(t);n&&e.searchParams.set("view",n)}return e.toString()}static encodeState(t){try{const e={t:t.toggles},n=JSON.stringify(e);let o;o="function"==typeof btoa?btoa(n):Buffer.from(n,"utf-8").toString("base64");return o.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}catch(t){return console.warn("Failed to encode state:",t),null}}static decodeState(t){try{let e,n=t.replace(/-/g,"+").replace(/_/g,"/");for(;n.length%4;)n+="=";e="function"==typeof atob?atob(n):Buffer.from(n,"base64").toString("utf-8");const o=JSON.parse(e);if(!o||"object"!=typeof o)throw new Error("Invalid compact state structure");return{toggles:Array.isArray(o.t)?o.t:[]}}catch(t){return console.warn("Failed to decode view state:",t),null}}}class s{hiddenToggles=new Set;setToggleVisibility(t,e){const n=this.hiddenToggles.has(t),o=!e;return o&&!n?(this.hiddenToggles.add(t),!0):!(o||!n)&&(this.hiddenToggles.delete(t),!0)}hideAll(t){for(const e of t)this.setToggleVisibility(e,!1)}showAll(t){for(const e of t)this.setToggleVisibility(e,!0)}getHiddenToggles(){return Array.from(this.hiddenToggles)}filterVisibleToggles(t){return t.filter(t=>!this.hiddenToggles.has(t))}applyElementVisibility(t,e){e?(t.classList.remove("cv-hidden"),t.classList.add("cv-visible")):(t.classList.add("cv-hidden"),t.classList.remove("cv-visible"))}}class i{rootEl;assetsManager;persistenceManager;visibilityManager;stateFromUrl=null;localConfig;stateChangeListeners=[];constructor(t){this.assetsManager=t.assetsManager,this.localConfig=t.config,this.rootEl=t.rootEl||document.body,this.persistenceManager=new n,this.visibilityManager=new s}getLocalConfig(){return this.localConfig}async init(){!function(){if("undefined"==typeof document)return;if(document.querySelector("#cv-core-styles"))return;const t=document.createElement("style");t.id="cv-core-styles",t.textContent="\n[data-customviews-toggle] {\n  transition: opacity 150ms ease,\n              transform 150ms ease,\n              max-height 200ms ease,\n              margin 150ms ease;\n  will-change: opacity, transform, max-height, margin;\n}\n\n.cv-visible {\n  opacity: 1 !important;\n  transform: translateY(0) !important;\n  max-height: var(--cv-max-height, 9999px) !important;\n}\n\n.cv-hidden {\n  opacity: 0 !important;\n  transform: translateY(-4px) !important;\n  pointer-events: none !important;\n  padding-top: 0 !important;\n  padding-bottom: 0 !important;\n  border-top-width: 0 !important;\n  border-bottom-width: 0 !important;\n  max-height: 0 !important;\n  margin-top: 0 !important;\n  margin-bottom: 0 !important;\n  overflow: hidden !important;\n}\n",document.head.appendChild(t)}(),window.addEventListener("popstate",()=>{this.loadAndRenderState()}),this.loadAndRenderState()}async loadAndRenderState(){if(this.stateFromUrl=o.parseURL(),this.stateFromUrl)return void this.applyState(this.stateFromUrl);const t=this.persistenceManager.getPersistedState();t?this.applyState(t):this.renderState(this.localConfig.defaultState)}applyState(t){this.renderState(t),this.persistenceManager.persistState(t),this.stateFromUrl=t,o.updateURL(t)}renderState(t){const n=t.toggles||[],o=this.visibilityManager.filterVisibleToggles(n);this.rootEl.querySelectorAll("[data-customviews-toggle]").forEach(t=>{const e=t.dataset.customviewsToggle,n=!!e&&o.includes(e);this.visibilityManager.applyElementVisibility(t,n)});for(const t of o)this.rootEl.querySelectorAll(`[data-customviews-toggle="${t}"]`).forEach(t=>{const n=t.dataset.customviewsId;n&&e(t,n,this.assetsManager)});this.notifyStateChangeListeners()}resetToDefault(){this.stateFromUrl=null,this.persistenceManager.clearAll(),this.localConfig?this.renderState(this.localConfig.defaultState):console.warn("No configuration loaded, cannot reset to default state"),o.clearURL()}getCurrentActiveToggles(){return this.stateFromUrl?this.stateFromUrl.toggles||[]:this.localConfig&&this.localConfig.defaultState.toggles||[]}clearPersistence(){this.persistenceManager.clearAll(),this.stateFromUrl=null,this.localConfig?this.renderState(this.localConfig.defaultState):console.warn("No configuration loaded, cannot reset to default state"),o.clearURL()}addStateChangeListener(t){this.stateChangeListeners.push(t)}removeStateChangeListener(t){const e=this.stateChangeListeners.indexOf(t);e>-1&&this.stateChangeListeners.splice(e,1)}notifyStateChangeListeners(){this.stateChangeListeners.forEach(t=>{try{t()}catch(t){console.warn("Error in state change listener:",t)}})}}class a{assets;baseURL;constructor(t,e=""){this.assets=t,this.baseURL=e,this.validate()||console.warn("Invalid assets:",this.assets)}validate(){return Object.values(this.assets).every(t=>t.src||t.content)}get(t){const e=this.assets[t];if(e)return this.baseURL&&e.src?{...e,src:this.prependBaseURL(e.src)}:e}prependBaseURL(t){if(t.startsWith("http://")||t.startsWith("https://"))return t;return(this.baseURL.endsWith("/")?this.baseURL.slice(0,-1):this.baseURL)+(t.startsWith("/")?t:"/"+t)}loadFromJSON(t){this.assets=t}loadAdditionalAssets(t){this.assets={...this.assets,...t}}}class r{core;container;widgetIcon=null;options;modal=null;constructor(t){this.core=t.core,this.container=t.container||document.body,this.options={core:t.core,container:this.container,position:t.position||"middle-left",theme:t.theme||"light",showReset:t.showReset??!0,title:t.title||"Custom Views",description:t.description||"Toggle different content sections to customize your view. Changes are applied instantly and the URL will be updated for sharing.",showWelcome:t.showWelcome??!1,welcomeTitle:t.welcomeTitle||"Welcome to Custom Views!",welcomeMessage:t.welcomeMessage||"This website uses Custom Views to let you personalize your experience. Use the widget on the side (⚙) to show or hide different content sections based on your preferences. Your selections will be saved and can be shared via URL."}}render(){return this.widgetIcon=this.createWidgetIcon(),this.attachEventListeners(),document.body.appendChild(this.widgetIcon),this.options.showWelcome&&this.showWelcomeModalIfFirstVisit(),this.widgetIcon}createWidgetIcon(){const t=document.createElement("div");return t.className=`cv-widget-icon cv-widget-${this.options.position}`,t.innerHTML="⚙",t.title=this.options.title,t.setAttribute("aria-label","Open Custom Views"),function(){if(document.querySelector("#cv-widget-styles"))return;const t=document.createElement("style");t.id="cv-widget-styles",t.textContent="\n/* Rounded rectangle widget icon styles */\n.cv-widget-icon {\n  position: fixed;\n  background: white;\n  color: black;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 18px;\n  font-weight: bold;\n  cursor: pointer;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n  z-index: 9998;\n  transition: all 0.3s ease;\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n}\n\n.cv-widget-icon:hover {\n  background: white;\n  color: black;\n}\n\n/* Top-right: rounded end on left, sticks out leftward on hover */\n.cv-widget-top-right {\n  top: 20px;\n  right: 0;\n  border-radius: 18px 0 0 18px;\n  padding-left: 8px;\n  justify-content: flex-start;\n}\n\n/* Top-left: rounded end on right, sticks out rightward on hover */\n.cv-widget-top-left {\n  top: 20px;\n  left: 0;\n  border-radius: 0 18px 18px 0;\n  padding-right: 8px;\n  justify-content: flex-end;\n}\n\n/* Bottom-right: rounded end on left, sticks out leftward on hover */\n.cv-widget-bottom-right {\n  bottom: 20px;\n  right: 0;\n  border-radius: 18px 0 0 18px;\n  padding-left: 8px;\n  justify-content: flex-start;\n}\n\n/* Bottom-left: rounded end on right, sticks out rightward on hover */\n.cv-widget-bottom-left {\n  bottom: 20px;\n  left: 0;\n  border-radius: 0 18px 18px 0;\n  padding-right: 8px;\n  justify-content: flex-end;\n}\n\n/* Middle-left: rounded end on right, sticks out rightward on hover */\n.cv-widget-middle-left {\n  top: 50%;\n  left: 0;\n  transform: translateY(-50%);\n  border-radius: 0 18px 18px 0;\n  padding-right: 8px;\n  justify-content: flex-end;\n}\n\n/* Middle-right: rounded end on left, sticks out leftward on hover */\n.cv-widget-middle-right {\n  top: 50%;\n  right: 0;\n  transform: translateY(-50%);\n  border-radius: 18px 0 0 18px;\n  padding-left: 8px;\n  justify-content: flex-start;\n}\n\n.cv-widget-top-right,\n.cv-widget-middle-right,\n.cv-widget-bottom-right,\n.cv-widget-top-left,\n.cv-widget-middle-left,\n.cv-widget-bottom-left {\n  height: 36px;\n  width: 36px;\n}\n\n.cv-widget-middle-right:hover,\n.cv-widget-top-right:hover,\n.cv-widget-bottom-right:hover,\n.cv-widget-top-left:hover,\n.cv-widget-middle-left:hover,\n.cv-widget-bottom-left:hover {\n  width: 55px;\n}\n\n/* Modal content styles */\n.cv-widget-section {\n  margin-bottom: 16px;\n}\n\n.cv-widget-section:last-child {\n  margin-bottom: 0;\n}\n\n.cv-widget-section label {\n  display: block;\n  margin-bottom: 4px;\n  font-weight: 500;\n  color: #555;\n}\n\n.cv-widget-profile-select,\n.cv-widget-state-select {\n  width: 100%;\n  padding: 8px 12px;\n  border: 1px solid #ddd;\n  border-radius: 4px;\n  background: white;\n  font-size: 14px;\n}\n\n.cv-widget-profile-select:focus,\n.cv-widget-state-select:focus {\n  outline: none;\n  border-color: #007bff;\n  box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);\n}\n\n.cv-widget-profile-select:disabled,\n.cv-widget-state-select:disabled {\n  background: #f8f9fa;\n  color: #6c757d;\n  cursor: not-allowed;\n}\n\n.cv-widget-current {\n  margin: 16px 0;\n  padding: 12px;\n  background: #f8f9fa;\n  border-radius: 4px;\n  border-left: 4px solid #007bff;\n}\n\n.cv-widget-current label {\n  font-size: 12px;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n  color: #666;\n  margin-bottom: 4px;\n}\n\n.cv-widget-current-view {\n  font-weight: 500;\n  color: #333;\n}\n\n.cv-widget-reset {\n  width: 100%;\n  padding: 8px 16px;\n  background: #dc3545;\n  color: white;\n  border: none;\n  border-radius: 4px;\n  cursor: pointer;\n  font-size: 14px;\n  font-weight: 500;\n}\n\n.cv-widget-reset:hover {\n  background: #c82333;\n}\n\n.cv-widget-reset:active {\n  background: #bd2130;\n}\n\n/* Responsive design for mobile */\n@media (max-width: 768px) {\n  .cv-widget-top-right,\n  .cv-widget-top-left {\n    top: 10px;\n  }\n\n  .cv-widget-bottom-right,\n  .cv-widget-bottom-left {\n    bottom: 10px;\n  }\n\n  /* All widgets stay flush with screen edges */\n  .cv-widget-top-right,\n  .cv-widget-bottom-right,\n  .cv-widget-middle-right {\n    right: 0;\n  }\n\n  .cv-widget-top-left,\n  .cv-widget-bottom-left,\n  .cv-widget-middle-left {\n    left: 0;\n  }\n\n  /* Slightly smaller on mobile */\n  .cv-widget-icon {\n    width: 60px;\n    height: 32px;\n  }\n\n  .cv-widget-icon:hover {\n    width: 75px;\n  }\n}\n\n/* Modal styles */\n.cv-widget-modal-overlay {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 10002;\n  animation: fadeIn 0.2s ease;\n}\n\n@keyframes fadeIn {\n  from { opacity: 0; }\n  to { opacity: 1; }\n}\n\n.cv-widget-modal {\n  background: white;\n  border-radius: 8px;\n  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);\n  max-width: 400px;\n  width: 90vw;\n  max-height: 80vh;\n  overflow-y: auto;\n  animation: slideIn 0.2s ease;\n}\n\n@keyframes slideIn {\n  from { \n    opacity: 0;\n    transform: scale(0.9) translateY(-20px);\n  }\n  to { \n    opacity: 1;\n    transform: scale(1) translateY(0);\n  }\n}\n\n.cv-widget-modal-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 16px 20px;\n  border-bottom: 1px solid #e9ecef;\n  background: #f8f9fa;\n  border-radius: 8px 8px 0 0;\n}\n\n.cv-widget-modal-header h3 {\n  margin: 0;\n  font-size: 18px;\n  font-weight: 600;\n  color: #333;\n}\n\n.cv-widget-modal-close {\n  background: none;\n  border: none;\n  font-size: 24px;\n  cursor: pointer;\n  padding: 0;\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 4px;\n  color: #666;\n}\n\n.cv-widget-modal-close:hover {\n  background: #e9ecef;\n}\n\n.cv-widget-modal-content {\n  padding: 20px;\n}\n\n.cv-widget-modal-actions {\n  margin-top: 20px;\n  padding-top: 16px;\n  border-top: 1px solid #e9ecef;\n}\n\n.cv-widget-restore {\n  width: 100%;\n  padding: 10px 16px;\n  background: #28a745;\n  color: white;\n  border: none;\n  border-radius: 4px;\n  cursor: pointer;\n  font-size: 14px;\n  font-weight: 500;\n}\n\n.cv-widget-restore:hover {\n  background: #218838;\n}\n\n.cv-widget-create-state {\n  width: 100%;\n  padding: 10px 16px;\n  background: #007bff;\n  color: white;\n  border: none;\n  border-radius: 4px;\n  cursor: pointer;\n  font-size: 14px;\n  font-weight: 500;\n  margin-bottom: 10px;\n}\n\n.cv-widget-create-state:hover {\n  background: #0056b3;\n}\n\n/* Dark theme modal styles */\n.cv-widget-theme-dark .cv-widget-modal {\n  background: #2d3748;\n  color: #e2e8f0;\n}\n\n.cv-widget-theme-dark .cv-widget-modal-header {\n  background: #1a202c;\n  border-color: #4a5568;\n}\n\n.cv-widget-theme-dark .cv-widget-modal-header h3 {\n  color: #e2e8f0;\n}\n\n.cv-widget-theme-dark .cv-widget-modal-close {\n  color: #a0aec0;\n}\n\n.cv-widget-theme-dark .cv-widget-modal-close:hover {\n  background: #4a5568;\n}\n\n.cv-widget-theme-dark .cv-widget-modal-actions {\n  border-color: #4a5568;\n}\n\n/* Custom state creator styles */\n.cv-custom-state-modal {\n  max-width: 500px;\n}\n\n.cv-custom-state-form h4 {\n  margin: 20px 0 10px 0;\n  font-size: 16px;\n  font-weight: 600;\n  color: #333;\n  border-bottom: 1px solid #e9ecef;\n  padding-bottom: 5px;\n}\n\n.cv-custom-state-section {\n  margin-bottom: 16px;\n}\n\n.cv-custom-state-section label {\n  display: block;\n  margin-bottom: 4px;\n  font-weight: 500;\n  color: #555;\n}\n\n.cv-custom-state-input {\n  width: 100%;\n  padding: 8px 12px;\n  border: 1px solid #ddd;\n  border-radius: 4px;\n  background: white;\n  font-size: 14px;\n}\n\n.cv-custom-state-input:focus {\n  outline: none;\n  border-color: #007bff;\n  box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);\n}\n\n.cv-custom-toggles {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n  gap: 10px;\n}\n\n.cv-custom-state-toggle {\n  display: flex;\n  align-items: center;\n}\n\n.cv-custom-state-toggle label {\n  display: flex;\n  align-items: center;\n  cursor: pointer;\n  font-weight: normal;\n  margin: 0;\n}\n\n.cv-custom-toggle-checkbox {\n  margin-right: 8px;\n  width: auto;\n}\n\n.cv-custom-state-actions {\n  display: flex;\n  gap: 10px;\n  margin-top: 20px;\n  padding-top: 16px;\n  border-top: 1px solid #e9ecef;\n}\n\n.cv-custom-state-cancel,\n.cv-custom-state-copy-url {\n  flex: 1;\n  padding: 10px 16px;\n  border: none;\n  border-radius: 4px;\n  cursor: pointer;\n  font-size: 14px;\n  font-weight: 500;\n}\n\n.cv-custom-state-reset {\n  flex: 1;\n  padding: 10px 16px;\n  border: none;\n  border-radius: 4px;\n  cursor: pointer;\n  font-size: 14px;\n  font-weight: 500;\n  background: #dc3545;\n  color: white;\n}\n\n.cv-custom-state-reset:hover {\n  background: #c82333;\n}\n\n.cv-custom-state-cancel {\n  background: #6c757d;\n  color: white;\n}\n\n.cv-custom-state-cancel:hover {\n  background: #5a6268;\n}\n\n.cv-custom-state-copy-url {\n  background: #28a745;\n  color: white;\n}\n\n.cv-custom-state-copy-url:hover {\n  background: #218838;\n}\n\n/* Dark theme custom state styles */\n.cv-widget-theme-dark .cv-custom-state-form h4 {\n  color: #e2e8f0;\n  border-color: #4a5568;\n}\n\n.cv-widget-theme-dark .cv-custom-state-section label {\n  color: #a0aec0;\n}\n\n.cv-widget-theme-dark .cv-custom-state-input {\n  background: #1a202c;\n  border-color: #4a5568;\n  color: #e2e8f0;\n}\n\n.cv-widget-theme-dark .cv-custom-state-actions {\n  border-color: #4a5568;\n}\n\n/* Welcome modal styles */\n.cv-welcome-modal {\n  max-width: 500px;\n}\n\n.cv-welcome-content {\n  text-align: center;\n}\n\n.cv-welcome-content p {\n  font-size: 15px;\n  line-height: 1.6;\n  color: #555;\n  margin-bottom: 24px;\n}\n\n.cv-welcome-widget-preview {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 12px;\n  padding: 20px;\n  background: #f8f9fa;\n  border-radius: 8px;\n  margin-bottom: 24px;\n}\n\n.cv-welcome-widget-icon {\n  width: 36px;\n  height: 36px;\n  background: white;\n  color: black;\n  border-radius: 0 18px 18px 0;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 18px;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n}\n\n.cv-welcome-widget-label {\n  font-size: 14px;\n  color: #666;\n  margin: 0;\n  font-weight: 500;\n}\n\n.cv-welcome-got-it {\n  width: 100%;\n  padding: 12px 24px;\n  background: #007bff;\n  color: white;\n  border: none;\n  border-radius: 4px;\n  cursor: pointer;\n  font-size: 16px;\n  font-weight: 600;\n  transition: background 0.2s ease;\n}\n\n.cv-welcome-got-it:hover {\n  background: #0056b3;\n}\n\n.cv-welcome-got-it:active {\n  background: #004494;\n}\n\n/* Dark theme welcome modal styles */\n.cv-widget-theme-dark .cv-welcome-content p {\n  color: #cbd5e0;\n}\n\n.cv-widget-theme-dark .cv-welcome-widget-preview {\n  background: #1a202c;\n}\n\n.cv-widget-theme-dark .cv-welcome-widget-label {\n  color: #a0aec0;\n}\n",document.head.appendChild(t)}(),t}destroy(){this.widgetIcon&&(this.widgetIcon.remove(),this.widgetIcon=null),this.modal&&(this.modal.remove(),this.modal=null)}attachEventListeners(){this.widgetIcon&&this.widgetIcon.addEventListener("click",()=>this.openStateModal())}closeModal(){this.modal&&(this.modal.remove(),this.modal=null)}openStateModal(){const t=this.core.getLocalConfig(),e=t?.allToggles||[];this.createCustomStateModal(e)}createCustomStateModal(t){this.closeModal(),this.modal=document.createElement("div"),this.modal.className="cv-widget-modal-overlay",this.applyThemeToModal();const e=t.length?t.map(t=>`\n        <div class="cv-custom-state-toggle">\n          <label>\n            <input type="checkbox" class="cv-custom-toggle-checkbox" data-toggle="${t}" />\n            ${this.formatToggleName(t)}\n          </label>\n        </div>\n      `).join(""):'<p class="cv-no-toggles">No configurable sections available.</p>';this.modal.innerHTML=`\n      <div class="cv-widget-modal cv-custom-state-modal">\n        <div class="cv-widget-modal-header">\n          <h3>Customize View</h3>\n          <button class="cv-widget-modal-close" aria-label="Close modal">X</button>\n        </div>\n        <div class="cv-widget-modal-content">\n          <div class="cv-custom-state-form">\n            <p>${this.options.description}</p>\n            \n            <h4>Content Sections</h4>\n            <div class="cv-custom-toggles">\n              ${e}\n            </div>\n            \n            <div class="cv-custom-state-actions">\n              ${this.options.showReset?'<button class="cv-custom-state-reset">Reset to Default</button>':""}\n              <button class="cv-custom-state-copy-url">Copy Shareable URL</button>\n            </div>\n          </div>\n        </div>\n      </div>\n    `,document.body.appendChild(this.modal),this.attachStateModalEventListeners(),this.loadCurrentStateIntoForm()}attachStateModalEventListeners(){if(!this.modal)return;const t=this.modal.querySelector(".cv-widget-modal-close");t&&t.addEventListener("click",()=>{this.closeModal()});const e=this.modal.querySelector(".cv-custom-state-copy-url");e&&e.addEventListener("click",()=>{this.copyShareableURL()});const n=this.modal.querySelector(".cv-custom-state-reset");n&&n.addEventListener("click",()=>{this.core.resetToDefault(),this.loadCurrentStateIntoForm()});this.modal.querySelectorAll(".cv-custom-toggle-checkbox").forEach(t=>{t.addEventListener("change",()=>{const t=this.getCurrentCustomStateFromModal();this.core.applyState(t)})}),this.modal.addEventListener("click",t=>{t.target===this.modal&&this.closeModal()});const o=t=>{"Escape"===t.key&&(this.closeModal(),document.removeEventListener("keydown",o))};document.addEventListener("keydown",o)}applyThemeToModal(){this.modal&&("dark"===this.options.theme?this.modal.classList.add("cv-widget-theme-dark"):this.modal.classList.remove("cv-widget-theme-dark"))}getCurrentCustomStateFromModal(){if(!this.modal)return{toggles:[]};const t=[];return this.modal.querySelectorAll(".cv-custom-toggle-checkbox").forEach(e=>{const n=e.dataset.toggle;n&&e.checked&&t.push(n)}),{toggles:t}}copyShareableURL(){const t=this.getCurrentCustomStateFromModal(),e=o.generateShareableURL(t);navigator.clipboard.writeText(e).then(()=>{console.log("Shareable URL copied to clipboard!")}).catch(()=>{console.error("Failed to copy URL!")})}loadCurrentStateIntoForm(){if(!this.modal)return;const t=this.core.getCurrentActiveToggles();this.modal.querySelectorAll(".cv-custom-toggle-checkbox").forEach(t=>{t.checked=!1,t.disabled=!1,t.parentElement?.removeAttribute("aria-hidden")}),t.forEach(t=>{const e=this.modal?.querySelector(`[data-toggle="${t}"]`);e&&(e.disabled||(e.checked=!0))})}formatToggleName(t){return t.charAt(0).toUpperCase()+t.slice(1)}showWelcomeModalIfFirstVisit(){const t="cv-welcome-shown";localStorage.getItem(t)||(setTimeout(()=>{this.createWelcomeModal()},500),localStorage.setItem(t,"true"))}createWelcomeModal(){this.modal||(this.modal=document.createElement("div"),this.modal.className="cv-widget-modal-overlay cv-welcome-modal-overlay",this.applyThemeToModal(),this.modal.innerHTML=`\n      <div class="cv-widget-modal cv-welcome-modal">\n        <div class="cv-widget-modal-header">\n          <h3>${this.options.welcomeTitle}</h3>\n          <button class="cv-widget-modal-close" aria-label="Close modal">×</button>\n        </div>\n        <div class="cv-widget-modal-content">\n          <div class="cv-welcome-content">\n            <p>${this.options.welcomeMessage}</p>\n            \n            <div class="cv-welcome-widget-preview">\n              <div class="cv-welcome-widget-icon">⚙</div>\n              <p class="cv-welcome-widget-label">Look for this widget on the side of the screen</p>\n            </div>\n            \n            <button class="cv-welcome-got-it">Got it!</button>\n          </div>\n        </div>\n      </div>\n    `,document.body.appendChild(this.modal),this.attachWelcomeModalEventListeners())}attachWelcomeModalEventListeners(){if(!this.modal)return;const t=this.modal.querySelector(".cv-widget-modal-close");t&&t.addEventListener("click",()=>{this.closeModal()});const e=this.modal.querySelector(".cv-welcome-got-it");e&&e.addEventListener("click",()=>{this.closeModal()}),this.modal.addEventListener("click",t=>{t.target===this.modal&&this.closeModal()});const n=t=>{"Escape"===t.key&&(this.closeModal(),document.removeEventListener("keydown",n))};document.addEventListener("keydown",n)}}class c{static prependBaseURL(t,e){if(!e)return t;if(t.startsWith("http://")||t.startsWith("https://"))return t;return(e.endsWith("/")?e.slice(0,-1):e)+(t.startsWith("/")?t:"/"+t)}static async initFromJson(t){let e;const n=t.baseURL||"";if(t.assetsJsonPath){const o=this.prependBaseURL(t.assetsJsonPath,n),s=await(await fetch(o)).json();e=new a(s,n)}else e=new a({},n);let o;if(t.config)o=t.config;else{if(!t.configPath)return console.error("No config path provided, skipping custom views"),null;try{const e=this.prependBaseURL(t.configPath,n);o=await(await fetch(e)).json()}catch(t){return console.error("Error loading config:",t),null}}const s={assetsManager:e,config:o,rootEl:t.rootEl},r=new i(s);return r.init(),r}}"undefined"!=typeof window&&(window.CustomViews=c,window.CustomViewsWidget=r),t.AssetsManager=a,t.CustomViews=c,t.CustomViewsCore=i,t.CustomViewsWidget=r,t.LocalConfig=class{defaultState;allToggles;constructor(t,e){this.defaultState=t,this.allToggles=e}},t.PersistenceManager=n,t.URLStateManager=o});
//# sourceMappingURL=custom-views.umd.min.js.map
